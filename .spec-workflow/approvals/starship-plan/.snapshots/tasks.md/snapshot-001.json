{
  "id": "snapshot_1765881689246_ab98vks35",
  "approvalId": "approval_1765881689244_e2bj6z6um",
  "approvalTitle": "StarshipPlan 任务分解文档审批",
  "version": 1,
  "timestamp": "2025-12-16T10:41:29.246Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# StarshipPlan 任务分解文档\n\n## 项目概述\nStarshipPlan（星舰计划）是一个家庭内部使用的小学生习惯管理系统，采用太空冒险主题的游戏化设计。本文档将项目分解为具体的实施任务，每个任务都包含详细的实施指导和质量标准。\n\n## 任务列表\n\n### 1. 项目初始化和基础架构\n\n- [ ] 1.1 创建项目基础结构\n  - **文件**: 根目录创建前端、后端、移动端目录结构\n  - **任务**: 使用 Vite + React 创建前端项目，Express 创建后端项目，Capacitor 创建移动端项目\n  - **目的**: 建立标准的项目目录结构和开发环境\n  - **_Leverage**: npm create vite@latest, npx create-react-app, npx @capacitor/cli init_\n  - **_Requirements**: 技术栈设计要求\n  - **_Prompt**: 角色：全栈开发工程师 | 任务：创建完整的 StarshipPlan 项目基础结构，包括前端 React + TypeScript 项目、后端 Express + TypeScript 项目、移动端 Capacitor 项目配置 | 限制：遵循项目结构规范，确保 TypeScript 配置正确，设置合理的包管理结构 | 成功标准：所有项目能正常启动，TypeScript 编译无错误，基础依赖安装完成_\n\n- [ ] 1.2 配置开发环境和工具链\n  - **文件**: ESLint, Prettier, Git hooks 配置文件\n  - **任务**: 配置代码质量检查工具、格式化工具、Git 提交钩子\n  - **目的**: 确保团队开发代码质量和一致性\n  - **_Leverage**: ESLint, Prettier, Husky, lint-staged\n  - **_Requirements**: 代码质量要求\n  - **_Prompt**: 角色：DevOps 工程师 | 任务：配置完整的开发环境工具链，包括 ESLint 规则、Prettier 格式化、Git 提交钩子，确保代码质量和一致性 | 限制：配置不能过于严格影响开发效率，需要兼容团队开发习惯 | 成功标准：代码提交时自动执行质量检查，格式化自动应用，开发体验良好_\n\n### 2. 数据库设计和模型层\n\n- [ ] 2.1 设计数据库 Schema 和创建 Prisma 配置\n  - **文件**: prisma/schema.prisma, 数据库初始化脚本\n  - **任务**: 使用 Prisma 设计并定义所有数据模型，创建数据库迁移文件\n  - **目的**: 建立数据层的核心结构和类型安全\n  - **_Leverage**: Prisma CLI, SQLite3\n  - **_Requirements**: 数据模型设计（User, Task, TaskRecord, LevelRecord, PunishmentRecord）\n  - **_Prompt**: 角色：数据库架构师 | 任务：使用 Prisma 设计完整的数据库 schema，包括用户、任务、记录、等级、惩罚等所有模型，确保关系正确、索引合理、约束完整 | 限制：必须符合 SQLite 特性，避免过度复杂的关系设计，考虑查询性能 | 成功标准：所有模型定义正确，关系清晰，迁移文件执行成功，基础数据可正常CRUD操作_\n\n- [ ] 2.2 创建数据库服务层\n  - **文件**: src/services/database.ts, src/utils/db-utils.ts\n  - **任务**: 封装数据库连接、事务处理、错误处理等基础服务\n  - **目的**: 提供统一的数据访问接口和错误处理机制\n  - **_Leverage**: Prisma Client, 事务处理模式\n  - **_Requirements**: 数据可靠性要求，错误处理策略\n  - **_Prompt**: 角色：后端开发工程师 | 任务：创建数据库服务层，封装 Prisma Client，提供事务支持、连接管理、错误处理等功能，确保数据操作的安全性和一致性 | 限制：不能暴露原始数据库操作给上层服务，必须正确处理所有异常情况 | 成功标准：数据库服务稳定可靠，事务处理正确，异常情况有合适的错误信息和恢复机制_\n\n### 3. 后端 API 开发\n\n- [ ] 3.1 创建基础 API 服务器和路由结构\n  - **文件**: src/server.ts, src/routes/, src/middleware/\n  - **任务**: 设置 Express 服务器，配置基础中间件、路由结构、错误处理\n  - **目的**: 建立后端服务的基础框架\n  - **_Leverage**: Express.js, cors helmet, compression, Winston\n  - **_Requirements**: 系统架构设计，错误处理策略\n  - **_Prompt**: 角色：后端架构师 | 任务：创建完整的 Express 服务器配置，包括安全中间件、路由结构、全局错误处理、日志系统、CORS 配置等，确保服务器安全可靠 | 限制：必须遵循安全最佳实践，错误处理不能泄露敏感信息，日志记录要详细但不冗余 | 成功标准：服务器能正常启动，基础 API 响应正常，安全中间件生效，日志系统工作正常_\n\n- [ ] 3.2 实现用户认证和授权 API\n  - **文件**: src/routes/auth.ts, src/middleware/auth.ts, src/services/auth.ts\n  - **任务**: 实现用户注册、登录、权限验证、JWT 令牌管理\n  - **目的**: 提供安全的用户认证和权限控制系统\n  - **_Leverage**: bcryptjs, jsonwebtoken, Express middleware\n  - **_Requirements**: 家长控制功能，安全要求\n  - **_Prompt**: 角色：安全开发工程师 | 任务：实现用户认证系统，包括密码哈希、JWT 令牌生成和验证、权限中间件，确保家长和儿童角色的权限隔离，提供安全的认证流程 | 限制：密码必须正确哈希存储，JWT 密钥要安全，权限检查不能绕过，敏感操作需要验证 | 成功标准：认证流程安全可靠，权限控制正确，无法绕过权限检查，令牌管理安全_\n\n- [ ] 3.3 实现用户管理 API\n  - **文件**: src/routes/users.ts, src/services/userService.ts\n  - **任务**: 实现用户注册、登录、档案管理、设置更新等功能\n  - **目的**: 提供完整的用户数据管理 API\n  - **_Leverage**: Prisma User 模型，认证中间件\n  - **_Requirements**: 需求1：用户注册与档案管理\n  - **_Prompt**: 角色：后端开发工程师 | 任务：实现用户管理的完整 API，包括用户注册、登录验证、档案信息 CRUD、头像上传、设置管理等功能，确保数据验证和权限控制 | 限制：所有用户数据必须验证，敏感操作需要权限检查，避免数据泄露，处理并发更新冲突 | 成功标准：所有用户管理 API 功能正常，数据验证严格，权限控制有效，支持并发访问_\n\n- [ ] 3.4 实现任务管理 API\n  - **文件**: src/routes/tasks.ts, src/services/taskService.ts\n  - **任务**: 实现任务的创建、更新、删除、完成记录、统计分析等功能\n  - **目的**: 提供习惯任务的核心管理功能\n  - **_Leverage**: Prisma Task 和 TaskRecord 模型，定时任务调度器\n  - **_Requirements**: 需求2：习惯任务管理系统\n  - **_Prompt**: 角色：业务逻辑开发工程师 | 任务：实现任务管理的完整 API，包括任务模板创建、日常任务生成、完成记录、统计分析、自动结算等功能，确保业务逻辑正确和性能优化 | 限制：必须正确处理重复任务、时间计算、并发完成等复杂场景，保证数据一致性 | 成功标准：任务系统功能完整，计算逻辑准确，性能满足要求，支持复杂业务场景_\n\n- [ ] 3.5 实现积分和等级系统 API\n  - **文件**: src/routes/points.ts, src/services/pointsService.ts\n  - **任务**: 实现星币计算、等级管理、奖励发放、统计查询等功能\n  - **目的**: 提供游戏化积分系统的核心功能\n  - **_Leverage**: Prisma LevelRecord 模型，积分计算算法\n  - **_Requirements**: 需求3、4：星币积分系统、等级晋升系统\n  - **_Prompt**: 角色：游戏系统开发工程师 | 任务：实现积分和等级系统的完整 API，包括星币计算、等级晋升、奖励发放、兑换管理、统计分析等功能，确保算法正确和数据一致性 | 限制：积分计算必须准确无误，等级晋升要符合规则，兑换操作要事务安全，避免并发问题 | 成功标准：积分系统逻辑正确，等级晋升符合规则，统计查询准确，系统稳定可靠_\n\n- [ ] 3.6 实现惩罚和补救系统 API\n  - **文件**: src/routes/punishments.ts, src/services/punishmentService.ts\n  - **任务**: 实现惩罚记录、补救任务、申诉处理、家长确认等功能\n  - **目的**: 提供行为规范系统的管理功能\n  - **_Leverage**: Prisma PunishmentRecord 模型，规则引擎\n  - **_Requirements**: 需求9、10、11：行为规范与惩罚机制、补救与恢复机制、家长控制功能\n  - **_Prompt**: 角色：规则系统开发工程师 | 任务：实现惩罚和补救系统的 API，包括违规检测、惩罚计算、补救任务管理、申诉处理、家长审批等功能，确保规则执行公平合理 | 限制：惩罚规则必须可配置，申诉流程要透明，家长控制要有效，避免系统误判 | 成功标准：惩罚系统运行公正，补救机制有效，家长控制可靠，申诉处理及时_\n\n- [ ] 3.7 实现 WebSocket 实时同步服务\n  - **文件**: src/services/syncService.ts, src/routes/sync.ts\n  - **任务**: 实现多设备间的实时数据同步、离线缓存、冲突解决\n  - **目的**: 提供跨设备的实时数据同步功能\n  - **_Leverage**: Socket.io, 冲突解决算法，离线队列\n  - **_Requirements**: 需求8：跨平台同步\n  - **_Prompt**: 角色：实时系统开发工程师 | 任务：实现 WebSocket 实时同步服务，包括数据变更广播、离线数据处理、冲突检测和解决、同步状态管理等功能，确保多设备数据一致性 | 限制：必须处理网络中断、数据冲突、并发更新等复杂情况，保证数据不丢失，同步性能良好 | 成功标准：实时同步稳定可靠，冲突解决合理，离线数据处理正确，用户体验流畅_\n\n### 4. 前端核心组件开发\n\n- [ ] 4.1 创建基础 UI 组件库\n  - **文件**: src/components/ui/, src/styles/theme.ts\n  - **任务**: 创建按钮、输入框、卡片、对话框等基础 UI 组件，建立设计系统\n  - **目的**: 提供一致的界面风格和可复用的组件\n  - **_Leverage**: Tailwind CSS, React 组件模式, Storybook\n  - **_Requirements**: 界面设计要求，男孩子喜好导向\n  - **_Prompt**: 角色：UI/UX 开发工程师 | 任务：创建完整的太空主题 UI 组件库，包括基础组件、主题系统、动画效果、响应式设计，确保符合 9 岁男孩子的喜好和游戏化需求 | 限制：组件必须可复用、可访问、响应式，动画效果要流畅但不过度，主题要一致 | 成功标准：组件库功能完整，主题风格统一，动画效果良好，支持各种屏幕尺寸_\n\n- [ ] 4.2 实现用户认证界面\n  - **文件**: src/components/auth/, src/pages/auth/\n  - **任务**: 实现登录、注册、角色选择、密码重置等认证相关界面\n  - **目的**: 提供用户友好的认证流程界面\n  - **_Leverage**: 认证 API，表单验证，状态管理\n  - **_Requirements**: 需求1：用户注册与档案管理\n  - **_Prompt**: 角色：前端开发工程师 | 任务：实现用户认证界面，包括登录表单、注册流程、角色选择、头像上传、设置页面等功能，确保用户体验流畅，错误处理友好 | 限制：表单验证要完善，错误提示要清晰，加载状态要明确，支持键盘导航 | 成功标准：认证流程顺畅，用户引导清晰，错误处理友好，界面响应迅速_\n\n- [ ] 4.3 实现任务管理界面\n  - **文件**: src/components/tasks/, src/pages/tasks/\n  - **任务**: 实现任务列表、任务详情、任务创建、任务日历等功能\n  - **目的**: 提供直观的任务管理界面\n  - **_Leverage**: 任务 API，状态管理，拖拽交互\n  - **_Requirements**: 需求2：习惯任务管理系统，游戏化界面\n  - **_Prompt**: 角色：游戏界面开发工程师 | 任务：实现太空主题的任务管理界面，包括星球任务展示、任务卡片、完成动画、进度追踪、统计图表等功能，确保游戏化体验良好 | 限制：界面要符合太空冒险主题，动画要流畅但不影响性能，交互要直观易用，数据要实时更新 | 成功标准：任务界面游戏化程度高，交互体验好，数据同步及时，视觉效果吸引孩子兴趣_\n\n### 5. 游戏化界面和交互开发\n\n- [ ] 5.1 实现太空站主界面\n  - **文件**: src/components/space-station/, src/pages/home/\n  - **任务**: 实现个人空间站、宇航员角色、等级展示、星币显示等主界面元素\n  - **目的**: 提供沉浸式的太空冒险主界面\n  - **_Leverage**: React 3D 变换，动画库，状态管理\n  - **_Requirements**: 需求12：男孩子专属游戏化界面\n  - **_Prompt**: 角色：游戏 UI 开发工程师 | 任务：实现沉浸式的太空站主界面，包括 3D 视角效果、宇航员角色展示、装备系统、空间站装饰、实时状态显示等功能，确保游戏体验丰富 | 限制：3D 效果要优化性能，不能影响低端设备，动画要可配置，确保可访问性 | 成功标准：太空站界面视觉效果好，交互丰富，性能优化到位，孩子喜欢使用_\n\n- [ ] 5.2 实现星球任务系统\n  - **文件**: src/components/planets/, src/pages/explorer/\n  - **任务**: 实现星球探索、任务关联、星球占领、怪物对战等游戏化元素\n  - **目的**: 将任务管理系统转化为太空探险游戏\n  - **_Leverage**: 游戏引擎模式，状态机，动画系统\n  - **_Requirements**: 需求12：星球任务系统，太空对战元素\n  - **_Prompt**: 角色：游戏系统开发工程师 | 任务：实现星球任务游戏系统，包括星球地图、任务关联机制、怪物战斗系统、占领动画、连击奖励等功能，确保游戏性和实用性平衡 | 限制：游戏元素不能影响任务管理的实用性，战斗效果要适度，确保教育目标优先 | 成功标准：星球任务系统有趣味性，激励机制有效，孩子愿意持续使用，习惯养成效果明显-\n\n- [ ] 5.3 实现等级和奖励系统界面\n  - **文件**: src/components/levels/, src/pages/rewards/\n  - **任务**: 实现等级展示、装备收集、兑换商店、成就系统等功能\n  - **目的**: 提供激励性的等级成长和奖励界面\n  - **_Leverage**: 动画系统，粒子效果，音效管理\n  - **_Requirements**: 需求4：等级晋升系统，需求5：星币兑换系统\n  - **_Prompt**: 角色：游戏奖励系统开发工程师 | 任务：实现激励性的等级奖励界面，包括等级提升动画、装备展示系统、兑换商店、成就解锁、庆祝效果等功能，确保奖励机制有效激励孩子 | 限制：奖励系统不能过度功利化，要平衡激励和教育，音效动画要适度，避免沉迷 | 成功标准：等级系统激励效果明显，奖励机制合理，孩子有成就感，家长认可效果-\n\n- [ ] 5.4 实现音效和动画系统\n  - **文件**: src/utils/audio.ts, src/utils/animations.ts, src/assets/\n  - **任务**: 实现游戏音效、背景音乐、界面动画、交互反馈等\n  - **目的**: 提供沉浸式的游戏体验\n  - **_Leverage**: Web Audio API, Framer Motion, 音频文件\n  - **_Requirements**: 界面设计要求，音效设计\n  - **_Prompt**: 角色：多媒体开发工程师 | 任务：实现完整的音效和动画系统，包括任务完成音效、等级提升音乐、界面切换动画、按钮反馈音、背景音乐等，确保游戏体验丰富但不干扰 | 限制：音量要可控制，动画性能要优化，支持静音模式，避免过度刺激 | 成功标准：音效系统完整，动画流畅，用户体验沉浸，家长可以控制音量设置-\n\n### 6. 移动端开发\n\n- [ ] 6.1 配置 Capacitor 移动端项目\n  - **文件**: 移动端项目配置，原生插件集成\n  - **任务**: 使用 Capacitor 打包 Web 应用为 Android 应用，配置原生功能\n  - **目的**: 创建可在 Android 设备上运行的移动应用\n  - **_Leverage**: Capacitor CLI, Android Studio, 原生 API\n  - **_Requirements**: 兼容性要求，移动端适配\n  - **_Prompt**: 角色：移动端开发工程师 | 任务：配置 Capacitor 移动端项目，包括 Android 平台配置、原生插件集成、权限设置、图标启动页配置等，确保移动应用功能完整 | 限制：必须适配 Android 6.0+，权限申请要合理，包体积要优化，确保在低端设备上运行良好 | 成功标准：移动应用安装顺利，功能与 Web 版一致，性能良好，用户体验流畅-\n\n- [ ] 6.2 实现移动端特有功能\n  - **文件**: 移动端原生功能代码\n  - **任务**: 实现推送通知、本地存储、离线支持、手势操作等移动端特性\n  - **目的**: 提供移动端独有的用户体验\n  - **_Leverage**: Capacitor 插件，原生 API，PWA 技术\n  - **_Requirements**: 移动端特有功能，离线支持\n  - **_Prompt**: 角色：移动端功能开发工程师 | 任务：实现移动端特有功能，包括本地推送通知、离线数据缓存、手势导航、震动反馈、分享功能等，确保移动端体验优秀 | 限制：通知频率要合理，离线功能不能影响同步，手势操作要直观，隐私保护要到位 | 成功标准：移动端功能完整，通知及时有效，离线体验良好，手势操作自然-\n\n### 7. 家长控制功能开发\n\n- [ ] 7.1 实现家长管理界面\n  - **文件**: src/components/parent/, src/pages/admin/\n  - **任务**: 实现家长控制面板、任务设置、奖励管理、数据统计等功能\n  - **目的**: 提供完整的家长管理界面\n  - **_Leverage**: 图表库，数据可视化，权限控制\n  - **_Requirements**: 需求6：家长监控与控制，需求11：家长惩罚控制功能\n  - **_Prompt**: 角色：管理系统开发工程师 | 任务：实现家长管理界面，包括数据统计图表、任务管理、奖励设置、惩罚控制、进度报告、用户管理等功能，确保家长操作便捷有效 | 限制：界面要简洁易用，数据展示要清晰，操作确认要充分，避免误操作 | 成功标准：家长管理功能完整，数据统计准确，操作流程顺畅，家长满意使用体验-\n\n- [ ] 7.2 实现数据统计和报告功能\n  - **文件**: src/components/reports/, src/utils/chartUtils.ts\n  - **任务**: 实现习惯养成报告、数据可视化、趋势分析、PDF 导出等功能\n  - **目的**: 提供专业的数据分析报告\n  - **_Leverage**: Chart.js, 数据分析算法，PDF 生成库\n  - **_Requirements**: 需求7：数据统计与报告\n  - **_Prompt**: 角色：数据分析开发工程师 | 任务：实现数据统计和报告功能，包括习惯完成率分析、趋势图表、进步报告、PDF 导出、数据对比等，为家长提供专业的教育分析 | 限制：数据分析要准确，图表展示要直观，报告内容要有教育价值，PDF 格式要专业 | 成功标准：数据分析准确，报告内容有价值，图表展示清晰，家长能够据此做出教育决策-\n\n### 8. 系统集成和测试\n\n- [ ] 8.1 实现 API 集成和状态管理\n  - **文件**: src/store/, src/hooks/, src/services/api.ts\n  - **任务**: 实现前后端数据交互、状态管理、缓存策略、错误处理\n  - **目的**: 确保前后端数据同步和状态一致性\n  - **_Leverage**: Zustand, React Query, 错误边界\n  - **_Requirements**: 数据同步要求，状态管理\n  - **_Prompt**: 角色：全栈集成工程师 | 任务：实现完整的前后端集成，包括 API 客户端、状态管理、缓存策略、错误处理、离线支持等，确保数据同步和用户体验 | 限制：状态管理要简单高效，缓存策略要合理，错误处理要友好，离线功能要可靠 | 成功标准：前后端集成稳定，数据同步及时，状态管理清晰，用户体验流畅-\n\n- [ ] 8.2 编写单元测试和集成测试\n  - **文件**: tests/ 目录结构，测试用例文件\n  - **任务**: 为所有核心功能编写单元测试、集成测试、端到端测试\n  - **目的**: 确保系统质量和稳定性\n  - **_Leverage**: Jest, React Testing Library, Cypress, 测试工具\n  - **_Requirements**: 测试策略，质量要求\n  - **_Prompt**: 角色：测试工程师 | 任务：编写完整的测试套件，包括单元测试、集成测试、端到端测试，覆盖所有核心功能和业务逻辑，确保系统质量 | 限制：测试覆盖率要达到 80% 以上，测试用例要有效，避免测试维护成本过高 | 成功标准：测试覆盖率高，所有测试通过，能够有效捕获 bug，确保系统稳定-\n\n- [ ] 8.3 实现部署和运维工具\n  - **文件**: scripts/, docker/, docs/\n  - **任务**: 创建一键部署脚本、Docker 容器、备份恢复工具、监控日志\n  - **目的**: 提供简单易用的部署和运维方案\n  - **_Leverage**: Docker, Shell 脚本，监控工具，文档工具\n  - **_Requirements**: 部署要求，维护要求\n  - **_Prompt**: 角色：DevOps 工程师 | 任务：创建完整的部署和运维方案，包括一键安装脚本、Docker 部署、数据备份恢复、系统监控、日志管理、更新机制等，确保家长能够轻松维护 | 限制：部署过程要简单，文档要详细，故障处理要有效，系统要稳定可靠 | 成功标准：一键部署成功，运维工具完善，文档清晰易懂，系统稳定运行-\n\n## 实施指南\n\n### 开发顺序建议\n1. **第一阶段**：项目初始化、数据库设计、基础 API\n2. **第二阶段**：核心业务 API、基础 UI 组件\n3. **第三阶段**：游戏化界面、移动端开发\n4. **第四阶段**：家长控制功能、系统集成测试\n5. **第五阶段**：部署优化、文档完善\n\n### 里程碑设置\n- **里程碑 1**：基础架构完成，API 可用\n- **里程碑 2**：核心功能完成，基础界面可用\n- **里程碑 3**：游戏化完成，移动端可用\n- **里程碑 4**：全部功能完成，测试通过\n- **里程碑 5**：部署完成，文档齐全\n\n### 质量控制\n- 每个任务完成后必须通过代码审查\n- 所有 API 必须有对应的测试用例\n- 所有界面必须进行用户体验测试\n- 部署前必须进行完整的集成测试\n\n### 风险管理\n- 技术风险：选择成熟稳定的技术栈，避免过度创新\n- 进度风险：合理估算工作量，设置缓冲时间\n- 质量风险：建立完善的测试体系，确保代码质量\n- 维护风险：编写详细文档，降低维护复杂度",
  "fileStats": {
    "size": 22327,
    "lines": 250,
    "lastModified": "2025-12-16T10:41:11.730Z"
  },
  "comments": []
}