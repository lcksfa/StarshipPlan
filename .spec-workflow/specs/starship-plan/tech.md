# StarshipPlan 技术栈

## 项目类型
**家庭内部使用的习惯管理系统** - 包含Web应用和Android移动端的本地部署项目，专为9岁儿童设计游戏化习惯养成体验。

## 核心技术

### 主要编程语言
- **JavaScript/TypeScript**: 前端开发，Node.js后端服务
  - **Runtime**: Node.js 18.x LTS (稳定版本)
  - **工具链**: npm, npx, ts-node
- **Python**: 后端API开发 (备选方案)
  - **Runtime**: Python 3.11
  - **工具链**: pip, poetry, venv

### 核心依赖库
#### 前端技术栈
- **React 18.2**: 主要前端框架，组件化开发
- **TypeScript 5.x**: 类型安全，提高代码质量
- **Vite 5.x**: 快速构建工具，热重载开发体验
- **Tailwind CSS 3.x**: 实用优先的CSS框架，快速样式开发
- **Framer Motion**: 动画库，实现游戏化交互动效
- **React Router 6.x**: 前端路由管理
- **Zustand**: 轻量级状态管理，适合小型项目

#### 移动端打包
- **Capacitor 5.x**: 混合应用开发框架，一套代码多平台运行
- **Ionic Framework**: UI组件库，提供移动端原生体验

#### 后端技术栈 (Node.js方案)
- **Express.js 4.x**: 轻量级Web框架，API开发
- **Socket.io**: 实时双向通信，多设备数据同步
- **SQLite3**: 轻量级文件数据库，无需额外服务器
- **Prisma**: 现代化ORM工具，类型安全的数据库操作
- **Winston**: 日志管理工具
- **Node-cron**: 定时任务调度，每日结算

#### 后端技术栈 (Python备选)
- **Flask 2.x**: 轻量级Web框架
- **SQLAlchemy**: Python ORM，数据库操作
- **Flask-SocketIO**: WebSocket支持
- **APScheduler**: 任务调度器
- **Flask-JWT-Extended**: 用户认证 (简化版本)

### 应用架构
**客户端-服务器架构**，前后端分离模式
- **前端**: SPA单页应用，React组件化设计
- **后端**: RESTful API + WebSocket实时通信
- **数据层**: SQLite本地数据库，JSON文件备份
- **部署**: 本地服务器，家庭网络内访问

### 数据存储
- **主数据库**: SQLite 3.x
  - 文件位置: `./data/starship_plan.db`
  - 备份位置: `./data/backups/`
- **缓存策略**: 
  - 浏览器LocalStorage: 用户偏好设置
  - 内存缓存: 活跃会话数据
- **数据格式**: JSON (API通信), SQLite (持久化存储)
- **备份格式**: JSON文件 + SQLite数据库副本

### 外部集成
- **协议**: HTTP/REST, WebSocket, TCP/IP
- **认证**: 简化JWT (家庭内部使用，无需OAuth)
- **通知**: Web Notification API, 本地推送
- **文件存储**: 本地文件系统

### 监控与仪表板技术
- **实时通信**: Socket.io (WebSocket)
- **状态管理**: Zustand (轻量级状态管理)
- **可视化**: Chart.js (数据图表), CSS动画 (游戏效果)
- **日志**: Winston后端日志 + 前端Console日志

## 开发环境

### 构建与开发工具
- **构建系统**: Vite (前端), npm scripts (全栈)
- **包管理**: npm (Node.js), pip (Python备选)
- **开发工作流**: 热重载开发服务器, TypeScript编译, ESLint代码检查

### 代码质量工具
- **静态分析**: ESLint, Prettier (代码格式化), TypeScript (类型检查)
- **格式化**: Prettier + EditorConfig (统一代码风格)
- **测试框架**: Jest (单元测试), React Testing Library (组件测试)
- **文档**: JSDoc注释, README文档

### 版本控制与协作
- **VCS**: Git
- **分支策略**: 简化的Git Flow (main, develop, feature分支)
- **代码审查**: 家庭内部代码审查，Pull Request流程

### 开发环境配置
- **热重载**: Vite开发服务器，文件监听自动刷新
- **端口管理**: 前端3000, 后端8000, 可配置端口
- **多实例支持**: 支持多个开发实例同时运行

## 部署与分发

### 目标平台
- **Web端**: Chrome, Safari, Edge, Firefox现代浏览器
- **移动端**: Android 6.0+ (适配旧设备), iOS 12+ (未来扩展)
- **服务器**: 树莓派, 家庭NAS, Windows/Mac/Linux主机
- **网络**: 家庭WiFi环境，无需外网访问

### 分发方式
- **源码分发**: GitHub仓库下载
- **一键安装**: Shell脚本自动部署
- **Docker容器**: 容器化部署 (可选)
- **移动应用**: APK文件手动安装

### 安装要求
- **最低配置**: 2GB RAM, 10GB存储空间
- **系统要求**: Windows 10+, macOS 10.15+, Ubuntu 18.04+
- **网络环境**: 家庭WiFi路由器
- **依赖**: Node.js 18+, Git

### 更新机制
- **自动检查**: 应用启动时检查更新
- **数据迁移**: 平滑的数据库结构升级
- **回滚功能**: 更新失败时自动恢复之前版本
- **增量更新**: 只下载变更部分

## 技术要求与约束

### 性能要求
- **启动时间**: 应用启动 < 5秒 (家庭网络环境)
- **响应时间**: API响应 < 2秒，界面交互 < 1秒
- **并发用户**: 支持3-5个家庭成员同时使用
- **同步延迟**: 家庭网络内数据同步 < 10秒

### 兼容性要求
- **平台支持**: Windows, macOS, Linux (服务器端), Android (移动端)
- **浏览器**: Chrome 90+, Safari 14+, Edge 90+, Firefox 88+
- **Node.js**: 18.x LTS版本
- **Android**: 6.0+ (覆盖95%以上设备)

### 安全与合规
- **安全要求**: 本地部署，家庭网络隔离，基础认证
- **数据保护**: 本地数据存储，无第三方数据传输
- **威胁模型**: 家庭内部使用，威胁等级较低

### 可扩展性与可靠性
- **预期负载**: 单个家庭使用，最大10个用户
- **可用性**: 家庭网络环境稳定运行
- **数据增长**: 预计年数据量 < 1GB

## 技术决策与理由

### 决策记录

1. **选择SQLite而非PostgreSQL/MySQL**: 
   - 理由: 零配置、文件数据库、适合家庭项目、无需数据库管理员
   - 权衡: 不支持高并发，但对家庭使用完全足够

2. **选择React而非Vue**: 
   - 理由: 生态系统更成熟，游戏化组件资源丰富，学习资料多
   - 权衡: 初始学习曲线稍陡峭，但长期收益更好

3. **选择本地部署而非云端SaaS**:
   - 理由: 数据隐私保护、零运行成本、完全控制权
   - 权衡: 需要家庭内部维护，但简单易学

4. **选择Capacitor而非原生Android开发**:
   - 理由: 一套代码多平台、降低开发成本、便于维护
   - 权衡: 性能略逊于原生，但对家庭应用影响很小

5. **选择TypeScript而非JavaScript**:
   - 理由: 类型安全、减少运行时错误、更好的IDE支持
   - 权衡: 需要编译步骤，但开发体验和代码质量显著提升

### 架构设计选择
- **前后端分离**: 便于开发维护，支持多端访问
- **组件化设计**: 功能模块化，代码复用性高
- **状态管理简化**: 使用Zustand而非Redux，适合小型项目

## 已知限制与改进方向

### 当前限制
1. **同步性能**: 基于WebSocket的实时同步，网络不稳定时可能延迟
   - **影响**: 数据更新可能稍有延迟
   - **未来方案**: 优化冲突解决算法，增加离线队列

2. **动画性能**: 移动端复杂动画可能影响性能
   - **影响**: 低端设备上动画可能卡顿
   - **未来方案**: 性能检测，自动降级简化动画

3. **备份管理**: 当前依赖手动备份
   - **影响**: 数据丢失风险存在
   - **未来方案**: 自动定时备份，云端备份选项

4. **用户权限**: 当前权限系统较为简单
   - **影响**: 细粒度控制不足
   - **未来方案**: 增加角色权限配置，更灵活的家长控制

### 技术债务
1. **错误处理**: 需要完善边界情况处理
2. **测试覆盖**: 单元测试和集成测试需要补充
3. **文档完善**: API文档和用户手册需要完善
4. **国际化**: 当前仅支持中文，未来可考虑多语言

### 性能优化空间
1. **代码分割**: 实现按需加载，减少初始包大小
2. **图片优化**: 压缩和格式优化，减少资源大小
3. **缓存策略**: 完善前端缓存机制
4. **数据库优化**: 索引优化，查询性能提升